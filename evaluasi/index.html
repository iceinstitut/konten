<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Course Evaluation Form</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <style>
    body { background: #f8f9fa; }
    .card { border-radius: 12px; }
    .required::after { content: " *"; color: #d00; }
  </style>
</head>
<body>
  <div class="container py-5">
    <div class="row justify-content-center">
      <div class="col-lg-9">
        <div class="card shadow-sm">
          <div class="card-body p-4">
            <h3 class="mb-3">Course Evaluation Form</h3>
            <p class="text-muted">Silakan isi form berikut. Semua perubahan field dapat dilakukan di bagian <code>formFields</code> (file ini) agar fleksibel.</p>

            <form id="evalForm" novalidate>
              <div id="formFieldsContainer" class="row g-3"></div>

              <div class="mt-4">
                <button id="submitBtn" class="btn btn-primary">Kirim</button>
                <button id="resetBtn" type="button" class="btn btn-outline-secondary ms-2">Reset</button>
              </div>

            </form>
          </div>
        </div>

        <div class="text-center mt-3 text-muted small">Made with ❤️ by ICE Institute</div>
      </div>
    </div>
  </div>

<script>
/* ========== CONFIG ========== */
// Ganti URL ini dengan URL Web App (deployed) dari Google Apps Script Anda
const API_URL = "https://script.google.com/macros/s/AKfycbyT0GbkvykMKaq5MjKsP1Yv2eOvpCuwBuaiDmFDBwcDCsPwVb3eGAe88NJEd-2CbVgD4g/exec";

// Jika field form berubah, cukup edit array `formFields` di bawah.
// key = nama field yang akan dikirim dalam JSON (harus sesuai header di Google Sheet)
// type: text, email, date, select, radio, textarea, number
// option: untuk select/radio -> array
// required: true/false

const formFields = [
  { key: 'email', label: 'Email', type: 'email', required: true },
  { key: 'username', label: 'Username', type: 'text', required: true },
  { key: 'nama', label: 'Nama Lengkap', type: 'text', required: true },
  { key: 'Program', label: 'Program (Course)', type: 'text' },
  { key: 'institusiMk', label: 'Institusi', type: 'text' },
  { key: 'namaMk', label: 'Nama Mata Kuliah', type: 'text' },
  { key: 'Tanggal Penyelesaian', label: 'Tanggal Penyelesaian', type: 'date' },

  // Rating 1-4
  { key: 'how-satisfied-are-you-with-the-knowledge-you-gained-throughout-the-course', label: 'How satisfied are you with the knowledge you gained throughout the course?', type: 'select', option: ['1','2','3','4'] },
  { key: 'the-learning-resources-videos-articles-supported-my-understanding', label: 'The learning resources (videos/articles) supported my understanding', type: 'select', option: ['1','2','3','4'] },
  { key: 'how-effective-were-the-instructional-materials-used-in-the-course', label: 'How effective were the instructional materials used in the course?', type: 'select', option: ['1','2','3','4'] },
  { key: 'quizzes-and-assignments-helped-reinforce-my-understanding-of-the-material', label: 'Quizzes and assignments helped reinforce my understanding of the material', type: 'select', option: ['1','2','3','4'] },
  { key: 'how-effective-were-the-learning-activities-used-in-this-course', label: 'How effective were the learning activities used in this course?', type: 'select', option: ['1','2','3','4'] },

  // Yes/No
  { key: 'do-you-feel-you-achieved-your-desired-learning-outcome', label: 'Do you feel you achieved your desired learning outcome?', type: 'radio', option: ['yes','no'] },
  { key: 'did-the-course-meet-your-expectation', label: 'Did the course meet your expectation?', type: 'radio', option: ['yes','no'] },

  // 1-10
  { key: 'how-likely-are-you-to-recommend-this-course-to-a-friend-or-classmate', label: 'How likely are you to recommend this course to a friend or classmate (1-10)?', type: 'number', min: 1, max: 10 },

  { key: 'the-mooc-platform-was-easy-to-use-and-access', label: 'The MOOC platform was easy to use and access', type: 'select', option: ['1','2','3','4'] },
  { key: 'i-did-not-experience-significant-technical-issues-during-the-course', label: 'I did not experience significant technical issues during the course', type: 'select', option: ['1','2','3','4'] },
  { key: 'technical-support-was-responsive-and-helpful-if-any-issues-arose', label: 'Technical support was responsive and helpful if any issues arose', type: 'select', option: ['1','2','3','4'] },

  // Long text
  { key: 'tell-us-your-impressions-of-this-course', label: 'Tell us your impressions of this course', type: 'textarea' },
  { key: 'what-was-the-biggest-challenge-you-faced-during-the-course', label: 'What was the biggest challenge you faced during the course?', type: 'textarea' },
  { key: 'do-you-feel-any-additional-materials-or-support-features-are-needed-if-yes-please-explain', label: 'Do you feel any additional materials or support features are needed? If yes, please explain', type: 'textarea' },
  { key: 'saran', label: 'Saran', type: 'textarea' }
];

/* ========== RENDER FORM ========== */
const container = document.getElementById('formFieldsContainer');

function createField(f) {
  const col = document.createElement('div');
  col.className = 'col-12';

  const formGroup = document.createElement('div');
  formGroup.className = 'mb-3';

  const label = document.createElement('label');
  label.className = 'form-label ' + (f.required ? 'required' : '');
  label.textContent = f.label;
  label.setAttribute('for', f.key);
  formGroup.appendChild(label);

  let input;
  if (f.type === 'select') {
    input = document.createElement('select');
    input.className = 'form-select';
    input.id = f.key;
    input.name = f.key;
    if (!f.option || !Array.isArray(f.option)) f.option = ['1','2','3','4'];
    const optEmpty = document.createElement('option'); optEmpty.value = ''; optEmpty.text = '-- Pilih --'; input.appendChild(optEmpty);
    f.option.forEach(o => { const op = document.createElement('option'); op.value = o; op.text = o; input.appendChild(op); });
  } else if (f.type === 'radio') {
    input = document.createElement('div');
    f.option.forEach((o, idx) => {
      const rid = f.key + '_' + idx;
      const wrapper = document.createElement('div'); wrapper.className = 'form-check form-check-inline';
      const r = document.createElement('input'); r.className = 'form-check-input'; r.type = 'radio'; r.name = f.key; r.id = rid; r.value = o;
      const rl = document.createElement('label'); rl.className = 'form-check-label'; rl.htmlFor = rid; rl.textContent = o;
      wrapper.appendChild(r); wrapper.appendChild(rl); input.appendChild(wrapper);
    });
  } else if (f.type === 'textarea') {
    input = document.createElement('textarea');
    input.className = 'form-control';
    input.id = f.key; input.name = f.key; input.rows = 4;
  } else {
    input = document.createElement('input');
    input.className = 'form-control';
    input.type = f.type || 'text';
    input.id = f.key; input.name = f.key;
    if (f.min !== undefined) input.min = f.min;
    if (f.max !== undefined) input.max = f.max;
    if (f.placeholder) input.placeholder = f.placeholder;
  }

  if (f.required && f.type !== 'radio') input.required = true;

  formGroup.appendChild(input);
  col.appendChild(formGroup);
  return col;
}

formFields.forEach(f => container.appendChild(createField(f)));

/* ========== FORM SUBMIT ========== */
const form = document.getElementById('evalForm');
const submitBtn = document.getElementById('submitBtn');
const resetBtn = document.getElementById('resetBtn');

resetBtn.addEventListener('click', () => form.reset());

form.addEventListener('submit', async (ev) => {
  ev.preventDefault();
  if (!form.checkValidity()) {
    form.classList.add('was-validated');
    Swal.fire({ icon: 'warning', title: 'Form belum lengkap', text: 'Harap lengkapi field yang wajib.' });
    return;
  }

  // Build payload
  const formData = new FormData(form);
  const payload = {};
  for (const f of formFields) {
    if (f.type === 'radio') {
      const val = form.querySelector(`input[name="${f.key}"]:checked`);
      payload[f.key] = val ? val.value : '';
    } else {
      const v = formData.get(f.key);
      payload[f.key] = v === null ? '' : v;
    }
  }

  // Simple client-side validation for number ranges
  for (const f of formFields) {
    if (f.type === 'number' && payload[f.key]) {
      const n = Number(payload[f.key]);
      if ((f.min !== undefined && n < f.min) || (f.max !== undefined && n > f.max)) {
        Swal.fire({ icon: 'error', title: 'Invalid value', text: `${f.label} harus antara ${f.min} dan ${f.max}` });
        return;
      }
    }
  }

  // Disable button
  submitBtn.disabled = true;
  submitBtn.textContent = 'Mengirim...';

  try {
    const res = await fetch(API_URL, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload)
    });

    const j = await res.json();

    if (res.ok && j.status === 'success') {
      Swal.fire({ icon: 'success', title: 'Terkirim', text: 'Terima kasih, evaluasi Anda telah tersimpan.' });
      form.reset();
    } else {
      console.error('API Error', j);
      Swal.fire({ icon: 'error', title: 'Gagal', text: j.message || 'Terjadi kesalahan saat menyimpan data.' });
    }
  } catch (err) {
    console.error(err);
    Swal.fire({ icon: 'error', title: 'Gagal mengirim', text: err.toString() });
  } finally {
    submitBtn.disabled = false;
    submitBtn.textContent = 'Kirim';
  }
});
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>